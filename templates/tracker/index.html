{% extends 'tracker/base.html' %}
{% block content %}
    {% load static %}
{% if messages %}
<ul class="messages">
    {% for message in messages %}
    <li
            {% if message.tags %} class="{{ message.tags }}" {% endif %}>{{ message }}
    </li>
    {% endfor %}
</ul>
{% endif %}
    <!-- chart -->
    <div id="container" style="width: 75%;">
        <canvas id="sugar-chart" data-url="{% url 'sugar_chart' %}"></canvas>
    </div>
    <div id="container" style="width: 75%;">
        <canvas id="meal-chart" data-url="{% url 'meal_chart' %}"></canvas>
    </div>
    <div id="container" style="width: 75%;">
        <canvas id="mix-chart" data-url="{% url 'mix_chart' %}"></canvas>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="{% static 'js/moment.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/chartjs/Chart.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/hline.js' %}"></script>
    <script>

    $(function () {

      let sugarChart = $('#sugar-chart');
        $.ajax({
        url: sugarChart.data("url"),
        success: function (data) {
          var ctx2 = sugarChart[0].getContext("2d");

          new Chart(ctx2, {
            type: 'line',
            data:  data,
            options: {
                scales: {
                    xAxes: [{
                        type: 'time'
                    }]
                },
                horizontalLine: [{
                        y: 130,
                        style: "rgba(255, 0, 0, .4)",
                        text: "max"
                    },  {
                        y: 80,
                        text: "min"
                }],
              responsive: true,
              legend: {
                position: 'top',
              },
              title: {
                display: true,
                text: 'Sugar Level Chart'
              },
            }
          });

        }
      });
        let mealChart = $('#meal-chart');
        $.ajax({
        url: mealChart.data("url"),
        success: function (data) {
          var ctx2 = mealChart[0].getContext("2d");

          new Chart(ctx2, {
            type: 'line',
            data:  data,
            labels: ['Red', 'Blue', 'Purple'],
            options: {
                scales: {
                    xAxes: [{
                        type: 'time'
                    }]
                },
                horizontalLine: [{
                        y: 15,
                        style: "rgba(255, 0, 0, .4)",
                        text: "Carb Max"
                    }],
              responsive: true,
              legend: {
                position: 'top',
              },
              title: {
                display: true,
                text: 'Meal Chart'
              },
            }
          });

        }
      });
        let mixChart = $('#mix-chart');
        $.ajax({
        url: mixChart.data("url"),
        success: function (data) {
          var ctx2 = mixChart[0].getContext("2d");

          new Chart(ctx2, {
            type: 'line',
            data:  data,
            options: {
                scales: {
                    xAxes: [{
                        type: 'time'
                    }]
                },
                horizontalLine: [{
                        y: 130,
                        style: "rgba(255, 0, 0, .4)",
                        text: "varb max"
                    },  {
                        y: 80,
                        text: "min"
                }],
              responsive: true,
              legend: {
                position: 'top',
              },
              title: {
                display: true,
                text: 'Meal and Sugar LevelChart'
              },
            }
          });

        }
      });
    }
    );


  </script>
    <div class="btn-group-vertical">
    <a class="btn btn-primary" href="{% url 'add_sugar_level' %}">Add Sugar Level</a>
    <a class="btn btn-primary" href="{% url 'add_meal' %}">Add Meal</a>
    <a class="btn btn-secondary" href="{% url 'add_common_meal' %}">Add Common Meal</a>
    </div>

{% endblock content %}